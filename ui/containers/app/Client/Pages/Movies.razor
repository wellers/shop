@page "/movies"
@inject IMovieService MovieService
@inject ISessionService SessionService

<title>Movies</title>

<h3>Movies</h3>

<table class="table">
	<thead>
		<tr>
			<th>Title</th>
			<th>Price</th>
			<th></th>
		</tr>
	</thead>
	<tbody>
		@foreach (var movie in MovieService.Movies)
		{
		<tr>
			<td>@movie.Title</td>
			<td>@movie.Price</td>
			<td>
				<button class="btn btn-primary" @onclick="() => AddMovie(movie.Id)">Add to basket</button>
			</td>
		</tr>
		}
	</tbody>
</table>
<label>@MovieService.Message</label>
<button class="btn btn-secondary" @onclick="PurchaseBasket">Purchase Basket</button>

@code {
	protected override async Task OnInitializedAsync()
	{
		await MovieService.GetMovies();
	}

	async Task AddMovie(int id)
	{
		await MovieService.AddMovie(SessionService.SessionId, id);
	}
	
	async Task PurchaseBasket()
	{
		await MovieService.PurchaseBasket(SessionService.SessionId);
	}
}
